# Welcome to CriblVision for CriblSearch. 

Born from the same minds that brought you the Criblvision app for Splunk. You asked and we delivered! 

This Collection of Cribl Search dashboards and alerts was designed as a troubleshooting tool and monitoring aid for Cribl administrators. It was created by Cribl Professional Services to help customers troubleshoot and monitor their own Cribl Cloud Hybrid deployments. There are several troubleshooting dashboards tailored to certain product areas in which we have seen the highest number of recurring issues. While we intend to help you troubleshoot your own Cribl deployment, this collection will always be a continual "work in progress". It should always be used with the Cribl Monitoring Console and associated views.

Included in this collection are the following:

## **Dashboards**

**Health Check Dashboard** - An overview of the health of your deployment with the most common items you should be monitoring.

  

**Log statistics** - A dashboard designed to help you easily drill down into log messages generated by your worker nodes and surface any trends that will aid in troubleshooting issues.

  

**Volume Metrics** - The most requested dashboard for Cribl Search. Now you can easily see how much data is flowing through your deployment by route and pipeline along with reduction amounts and percentages for each.

  

**Thruput Introspection** - Easily drill down into throughput metrics for your sources and destinations and correlate any spikes or dips with CPU usage.

  

## **Alerts**

  

Another highly requested feature by the community was to have pre-configured alerts available to alert and notify you automatically about the health of your deployment. Included alerts are below:

  

CriblVision Alert - CPU Usage Over Threshold

CriblVision Alert - RSS Memory Usage

CriblVision Alert - Worker Process Restarted

CriblVision Alert - Destination Persistent Queue Initialized

CriblVision Alert - Unhealthy Destinations

CriblVision Alert - Unhealthy Sources

CriblVision Alert - Cluster Communication Errors

  

# Getting started

  

## **Installation instructions**

## Requirements

This is intended to be used with Cribl's entire product suite. You will need Owner/Admin permissions in your cribl cloud deployment and access to Cribl Search, Stream, Search, and Lake. This is currently only intended for use with hybrid worker groups. 

### Configure Data Lake destinations

  

Navigate to your hybrid worker group's destinations and click on Data Lakes -> Cribl Lake

You will create 2 Cribl-lake destinations with the following names

-cribl_lake_logs -> sending to the "default_logs" data set

-cribl_lake_metrics -> sending to the "default_metrics" data set

  

### Configure internal metrics and sources

-Navigate to your hybrid worker group's sources and enable both Cribl internal logs and metrics
-Navigate to your Cribl Internal logs source, click on fields, and add a new field with a name of group and a value that exactly matches your worker group's name.

### Configure routes

-Configure 2 routes, one will send data from the Cribl internal logs source, via a pass-thru pipeline to the cribl_lakes_logs destination. The other will send data from the cribl_internal metrics source via a passthru pipeline to the cribl_lake_metrics destination

  

  

### Configure search Macros

  

In Cribl Search, navigate to settings on the bottom left.

Click on Macros -> Add two macros with the following names and definitions

  
| Name |Definition  |
|--|--|
| set_cribl_metrics_dataset |  dataset="default_metrics" |
|set_cribl_logs_dataset|dataset="default_logs"|

  

### Populate Environment Assets lookup

  

The dropdowns in these worker groups rely on lookup called envrionment_assets which you will have to create. Follow the instructions below.

  

Navigate to search home and run the following search for the last hour:

  

    dataset="default_metrics" | distinct group, host

  

Export the search results as a CSV. Once the CSV has been downloaded, rename it to envrionment_assets.csv

  

Navigate to Data -> lookups -> add lookup file -> upload file and select the CSV that you just renamed.

 

  

### Installing Dashboards and Alerts
**Dashboards**
 
Inside of this repo, you will see two folders: dashboards and alerts.
  
The dashboard folder contains JSON files for each of the dashboards. For each of these JSON files you will have to do the following:

  

Navigate to Dashboards -> Click on Add Dashboard -> Name the dashboard with the same name as the JSON file -> click save -> Click on the ellipses on the upper right of the created dashboard and click "edit as JSON" -> click import and navigate to the JSON file -> click save and exit -> reload the dashboard once more for all changes to take effect.

  

Do this for every single JSON file in the dashboards directory.

  

**Alerts**

  

The Alerts folder of this repo contains .md files with the actual search query. For each of these files you will have to manually create each saved search.

  

Navigate to Search Home -> click Saved -> Add Search -> In the new Search Modal paste the search query from the text file into the search string box. Copy the name of the .md file in the name of the new search. Click Save.

  

Inside each alert file, you will find further instructions for setting up the search to run a schedule.


# Acknowledgements

**Author**: Johan Woger - Senior Professional Services Engineer - jwoger@cribl.io

**Contributors**
Jon Rust (Cribl)
David Sheridan (GKC)
Jeremy Prescott (Cribl)
Andrew Duca (Cribl)
Eugene Katz (Cribl)

## License

This project is licensed under the GNU General Public License (GPL). You are free to use, modify, and distribute this software under the terms of the license.
Christopher Owens (Cribl)
David Maislin (Cribl)
