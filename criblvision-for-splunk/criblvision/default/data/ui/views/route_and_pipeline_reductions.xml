<form theme="dark" version="1.1">
  <init>
    <set token="metric">route</set>
    <set token="metric_group_by">name</set>
    <set token="metric_expression">sum(`set_cribl_metrics_prefix(route.*)`) AS *</set>
  </init>
  <label>Route/Pipeline Reductions</label>
  <search>
    <done>
      <set token="init_bytes_unit_abbreviated_label">$result.bytes_unit_abbreviated_label$</set>
    </done>
    <query>| makeresults | eval bytes_unit_abbreviated_label = upper(`set_bytes_unit`)
    </query>
    <earliest>-1m@m</earliest>
    <latest>now</latest>
  </search>
  <search id="internal_io_summary_base_search" depends="$show_internal$">
    <query>| mstats sum(`set_cribl_metrics_prefix($metric$.*)`) AS * WHERE `set_cribl_metrics_index` $environment_filter$ $host_filter$ $worker_group_metric_pre_filter$ $metric_group_by$=$selected$ BY host group fillnull_value=`set_unknown_worker_group_value`
| lookup cribl_stream_assets host OUTPUTNEW instance_type worker_group
| search $worker_group_event_filter$ $worker_group_metric_filter$
| stats sum(*_bytes) AS *_bytes sum(*_events) AS *_events
| foreach *_bytes [ eval `process_bytes(&lt;&lt;FIELD&gt;&gt;, "$bytes_unit_abbreviated_label$")` ]</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <search id="redux_io_summary_base_search" depends="$show_redux$">
    <query>| mstats sum(e_*) AS e_* sum(raw_*) AS raw_* sum(count_*) AS count_* WHERE `set_cribl_metrics_index` $environment_filter$ $host_filter$ $metric_group_by$=$selected$ BY host cribl_pipe fillnull_value=`set_unknown_worker_group_value`
| lookup cribl_stream_assets host OUTPUTNEW instance_type worker_group
| search cribl_pipe != "cribl_reduction_metrics" $worker_group_event_filter$
| stats sum(*) AS *
| foreach e_* raw_* [ eval `process_bytes(&lt;&lt;FIELD&gt;&gt;, "$bytes_unit_abbreviated_label$")` ]</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <search id="internal_io_time_summary_base_search" depends="$show_internal$">
    <query>| mstats sum(`set_cribl_metrics_prefix($metric$.*)`) AS * WHERE `set_cribl_metrics_index` $environment_filter$ $host_filter$ $worker_group_metric_pre_filter$ $metric_group_by$=$selected$ BY host group span=auto fillnull_value=`set_unknown_worker_group_value`
| lookup cribl_stream_assets host OUTPUTNEW instance_type worker_group
| search $worker_group_event_filter$ $worker_group_metric_filter$
| stats sum(*_bytes) AS *_bytes sum(*_events) AS *_events BY _time
| foreach *_bytes [ eval `process_bytes(&lt;&lt;FIELD&gt;&gt;, "$bytes_unit_abbreviated_label$")` ]
| rename in_bytes AS "$bytes_unit_label$ In" out_bytes AS "$bytes_unit_label$ Out" in_events AS "Events In" out_events AS "Events Out"</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <search id="redux_io_time_summary_base_search" depends="$show_redux$">
    <query>| mstats sum(e_*) AS e_* sum(raw_*) AS raw_* sum(count_*) AS count_* WHERE `set_cribl_metrics_index` $environment_filter$ $host_filter$ $metric_group_by$=$selected$ BY host cribl_pipe span=auto fillnull_value=`set_unknown_worker_group_value`
| lookup cribl_stream_assets host OUTPUTNEW instance_type worker_group
| search cribl_pipe != "cribl_reduction_metrics" $worker_group_event_filter$
| stats sum(*) AS * BY _time
| foreach e_* raw_* [ eval `process_bytes(&lt;&lt;FIELD&gt;&gt;, "$bytes_unit_abbreviated_label$")` ]
| rename e_length_orig AS "Event $bytes_unit_label$ In" e_length_post AS "Event $bytes_unit_label$ Out" raw_length_orig AS "Raw $bytes_unit_label$ In" raw_length_post AS "Raw $bytes_unit_label$ Out" count_orig AS "Events In" count_post AS "Events Out"</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <search id="internal_io_breakdown_base_search" depends="$show_internal$">
    <query>| mstats sum(`set_cribl_metrics_prefix($metric$.*)`) AS * WHERE `set_cribl_metrics_index` $environment_filter$ $host_filter$ $worker_group_metric_pre_filter$ $metric_group_by$=$selected$ BY host group $metric_group_by$ fillnull_value=`set_unknown_worker_group_value`
| lookup cribl_stream_assets host OUTPUTNEW instance_type worker_group
| search $worker_group_event_filter$ $worker_group_metric_filter$
| stats sum(*_bytes) AS *_bytes sum(*_events) AS *_events BY $metric_group_by$ instance_type worker_group
| foreach *_bytes [ eval `process_bytes(&lt;&lt;FIELD&gt;&gt;, "$bytes_unit_abbreviated_label$")` ]</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <search id="redux_io_breakdown_base_search" depends="$show_redux$">
    <query>| mstats sum(e_*) AS e_* sum(raw_*) AS raw_* sum(count_*) AS count_* WHERE `set_cribl_metrics_index` $environment_filter$ $host_filter$ $metric_group_by$=$selected$ BY host group $metric_group_by$ fillnull_value=`set_unknown_worker_group_value`
| lookup cribl_stream_assets host OUTPUTNEW instance_type worker_group
| search cribl_pipe != "cribl_reduction_metrics" $worker_group_event_filter$
| stats sum(*) AS * BY $metric_group_by$ instance_type worker_group
| foreach e_* raw_* [ eval `process_bytes(&lt;&lt;FIELD&gt;&gt;, "$bytes_unit_abbreviated_label$")` ]</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <search id="annotation_search" ref="Deployment Annotations">
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <fieldset submitButton="true" autoRun="false">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>-15m</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="environment" searchWhenChanged="true">
      <label>Environment</label>
      <choice value="*">All Environments</choice>
      <fieldForLabel>environment</fieldForLabel>
      <fieldForValue>hosts</fieldForValue>
      <search>
        <query>| `dashboard_cribl_environment_filter`</query>
        <earliest>-1m@m</earliest>
        <latest>now</latest>
      </search>
      <change>
        <condition label="All Environments">
          <set token="environment_filter"></set>
        </condition>
        <condition>
          <set token="environment_filter">host IN ($environment$)</set>
        </condition>
      </change>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="dropdown" token="worker_group" searchWhenChanged="true">
      <label>Worker Group / Fleet / Single</label>
      <choice value="all_instances">All Instances</choice>
      <choice value="all_worker_groups">All Worker Groups</choice>
      <choice value="all_single">All Single Instances</choice>
      <fieldForLabel>label</fieldForLabel>
      <fieldForValue>worker_group</fieldForValue>
      <search>
        <query>| `dashboard_worker_group_filter($environment_filter|s$)`</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <change>
        <condition label="All Instances">
          <set token="worker_group_event_filter">instance_type IN (worker, single)</set>
          <set token="worker_group_metric_pre_filter"></set>
          <set token="worker_group_metric_filter">group=*</set>
        </condition>
        <condition label="All Worker Groups">
          <set token="worker_group_event_filter">instance_type=worker</set>
          <set token="worker_group_metric_pre_filter">group=*</set>
          <set token="worker_group_metric_filter">group=*</set>
        </condition>
        <condition label="All Single Instances">
          <set token="worker_group_event_filter">instance_type=single</set>
          <set token="worker_group_metric_pre_filter"></set>
          <set token="worker_group_metric_filter">group=`set_unknown_worker_group_value`</set>
        </condition>
        <condition>
          <set token="worker_group_event_filter">instance_type=worker worker_group="$worker_group$"</set>
          <set token="worker_group_metric_pre_filter">group="$worker_group$"</set>
          <set token="worker_group_metric_filter">group="$worker_group$"</set>
        </condition>
      </change>
      <default>all_instances</default>
      <initialValue>all_instances</initialValue>
    </input>
    <input type="dropdown" token="host">
      <label>Host</label>
      <fieldForLabel>label</fieldForLabel>
      <fieldForValue>host</fieldForValue>
      <search>
        <query>| `dashboard_host_filter($environment_filter|s$ $worker_group_event_filter|s$)`</query>
        <earliest>$time.earliest$</earliest>
        <latest>$time.latest$</latest>
      </search>
      <choice value="*">All Hosts</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <change>
        <condition>
          <set token="host_filter">host="$host$"</set>
        </condition>
      </change>
    </input>
    <input type="dropdown" token="metric" searchWhenChanged="true">
      <label>Show Routes or Pipelines</label>
      <choice value="route">Route</choice>
      <choice value="pipe">Pipeline</choice>
      <choice value="cribl_pipe">Pipeline (Redux Stats)</choice>
      <change>
        <condition>
          <eval token="metric_expression">if(label == "Route" OR label == "Pipeline", "sum(`set_cribl_metrics_prefix(".$metric$.".*)`) AS *", "sum(e_*) AS e_* sum(raw_*) AS raw_* sum(count_*) AS count_*")</eval>
          <eval token="metric_group_by">case(label == "Route", "name", label == "Pipeline", "id", label == "Pipeline (Redux Stats)", "cribl_pipe", true(), null())</eval>
          <eval token="show_internal">if(label == "Route" OR label == "Pipeline", "true", null())</eval>
          <eval token="show_internal_byte_io">if(label == "Route", "true", null())</eval>
          <eval token="show_redux">if(label == "Pipeline (Redux Stats)", "true", null())</eval>
          <eval token="selected_label">label</eval>
        </condition>
      </change>
      <default>route</default>
      <initialValue>route</initialValue>
    </input>
    <input type="dropdown" token="selected" searchWhenChanged="true">
      <label>Route / Pipeline</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>$metric_group_by$</fieldForLabel>
      <fieldForValue>$metric_group_by$</fieldForValue>
      <search>
        <query>| mstats $metric_expression$ WHERE `set_cribl_metrics_index` BY $metric_group_by$
| where $metric_group_by$ != "cribl_reduction_metrics"</query>
        <earliest>-15m</earliest>
        <latest>now</latest>
      </search>
      <prefix>"</prefix>
      <suffix>"</suffix>
    </input>
    <input type="dropdown" token="bytes_unit" searchWhenChanged="true">
      <label>Bytes Unit</label>
      <default>$init_bytes_unit_abbreviated_label$</default>
      <initialValue>$init_bytes_unit_abbreviated_label$</initialValue>
      <fieldForLabel>unit</fieldForLabel>
      <fieldForValue>abbreviated_unit</fieldForValue>
      <search>
        <query>| inputlookup bytes_units</query>
        <earliest>-1m@m</earliest>
        <latest>now</latest>
      </search>
      <change>
        <condition>
          <eval token="bytes_unit_abbreviated_label">value</eval>
          <eval token="bytes_unit_label">label</eval>
          <eval token="bytes_precision_single">if(lower(value) == "b", "0", "0.000")</eval>
          <eval token="bytes_precision_table">if(lower(value) == "b", "0", "3")</eval>
        </condition>
      </change>
    </input>
    <input type="link" token="how_to_use">
      <label>How to Use</label>
      <choice value="show">Show</choice>
      <choice value="hide">Hide</choice>
      <default>hide</default>
      <initialValue>hide</initialValue>
      <change>
        <eval token="show_details">if(label == "Show", "true", null())</eval>
      </change>
    </input>
  </fieldset>
  <row>
    <panel depends="$show_details$">
      <html>
        <div style="font-family: Arial; font-size: 11pt; list-style-type: square; text-align: center;">
          <p>This dashboard displays an overview of the byte/event I/O across either Routes or Pipelines, along with any reduction in bytes/events observed. A breakdown of I/O per Route/Pipeline is provided to investigate the reduction (or lack thereof) across Cribl Stream.</p>
          <p>The internal Cribl Stream metrics do not report bytes I/O metrics for Pipelines, therefore only information relating to event I/O is presented for Pipelines.</p>
          <p>The <code>Pipeline (Redux Stats)</code> option is to view the metrics provided by the Cribl Redux Stats Pack, created by the talented Jon Rust (search for "Cribl Redux Stats" in the <a href="https://packs.cribl.io" target="_blank">Packs Dispensary</a>). This Pack generates additional byte/event I/O metrics for instrumented Pipelines. It takes into account JSON objects, strings, the entire <code>__e</code> event, and <code>_raw</code> field in an attempt to get the most accurate byte size and count possible. It also provides metrics that detail the time taken for events to be processed by the instrumented Pipelines.</p>
          <p>
            <span style="color:#FF5733;font-weight:bold;">Using the Cribl Redux Stats Pack can have a performance impact on your environment.</span> If you are looking to leverage these metrics, please read the README in the Cribl Redux Stats Pack to understand the instrumentation process and the performance costs.</p>
        </div>
      </html>
    </panel>
  </row>
  <row depends="$show_internal$">
    <panel depends="$show_internal_byte_io$">
      <single>
        <title>Total $bytes_unit_label$ In</title>
        <search base="internal_io_summary_base_search">
          <query>
| table in_bytes</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">$bytes_precision_single$</option>
        <option name="rangeColors">["0xB88073","0xB88073"]</option>
        <option name="rangeValues">[0]</option>
        <option name="unit">$bytes_unit_abbreviated_label$</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel depends="$show_internal_byte_io$">
      <single>
        <title>Total $bytes_unit_label$ Out</title>
        <search base="internal_io_summary_base_search">
          <query>
| table out_bytes</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">$bytes_precision_single$</option>
        <option name="rangeColors">["0xE38E6F","0xE38E6F"]</option>
        <option name="rangeValues">[0]</option>
        <option name="unit">$bytes_unit_abbreviated_label$</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Total Events In</title>
        <search base="internal_io_summary_base_search">
          <query>
| table in_events</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x2A6293","0x2A6293"]</option>
        <option name="rangeValues">[0]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Total Events Out</title>
        <search base="internal_io_summary_base_search">
          <query>
| table out_events</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x78A1C1","0x78A1C1"]</option>
        <option name="rangeValues">[0]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row depends="$show_redux$">
    <panel>
      <single>
        <title>Total Raw $bytes_unit_label$ In</title>
        <search base="redux_io_summary_base_search">
          <query>
| table raw_length_orig</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">$bytes_precision_single$</option>
        <option name="rangeColors">["0xB88073","0xB88073"]</option>
        <option name="rangeValues">[0]</option>
        <option name="unit">$bytes_unit_abbreviated_label$</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Total Raw $bytes_unit_label$ Out</title>
        <search base="redux_io_summary_base_search">
          <query>
| table raw_length_post</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">$bytes_precision_single$</option>
        <option name="rangeColors">["0xE38E6F","0xE38E6F"]</option>
        <option name="rangeValues">[0]</option>
        <option name="unit">$bytes_unit_abbreviated_label$</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Total Event $bytes_unit_label$ In</title>
        <search base="redux_io_summary_base_search">
          <query>
| table e_length_orig</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">$bytes_precision_single$</option>
        <option name="rangeColors">["0xB88073","0xB88073"]</option>
        <option name="rangeValues">[0]</option>
        <option name="unit">$bytes_unit_abbreviated_label$</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Total Event $bytes_unit_label$ Out</title>
        <search base="redux_io_summary_base_search">
          <query>
| table e_length_post</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">$bytes_precision_single$</option>
        <option name="rangeColors">["0xE38E6F","0xE38E6F"]</option>
        <option name="rangeValues">[0]</option>
        <option name="unit">$bytes_unit_abbreviated_label$</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Total Events In</title>
        <search base="redux_io_summary_base_search">
          <query>
| table count_orig</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x2A6293","0x2A6293"]</option>
        <option name="rangeValues">[0]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Total Events Out</title>
        <search base="redux_io_summary_base_search">
          <query>
| table count_post</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x78A1C1","0x78A1C1"]</option>
        <option name="rangeValues">[0]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row depends="$show_internal$">
    <panel depends="$show_internal_byte_io$">
      <single>
        <title>Total $bytes_unit_label$ Reduced</title>
        <search base="internal_io_summary_base_search">
          <query>
| eval bytes_reduced = in_bytes - out_bytes
| table bytes_reduced</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">$bytes_precision_single$</option>
        <option name="rangeColors">["0xd41f1f","0x118832"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">$bytes_unit_abbreviated_label$</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel depends="$show_internal_byte_io$">
      <single>
        <title>% of $bytes_unit_label$ Reduced</title>
        <search base="internal_io_summary_base_search">
          <query>
| eval bytes_reduced_pct = ((in_bytes - out_bytes) / in_bytes) * 100
| table bytes_reduced_pct</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xd41f1f","0x118832"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Total Events Reduced</title>
        <search base="internal_io_summary_base_search">
          <query>
| eval events_reduced = in_events - out_events
| table events_reduced</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0xd41f1f","0x118832"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>% of Events Reduced</title>
        <search base="internal_io_summary_base_search">
          <query>
| eval events_reduced_pct = ((in_events - out_events) / in_events) * 100
| table events_reduced_pct</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xd41f1f","0x118832"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row depends="$show_redux$">
    <panel>
      <single>
        <title>Total Raw $bytes_unit_label$ Reduced</title>
        <search base="redux_io_summary_base_search">
          <query>
| eval raw_bytes_reduced = raw_length_orig - raw_length_post
| table raw_bytes_reduced</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">$bytes_precision_single$</option>
        <option name="rangeColors">["0xd41f1f","0x118832"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">$bytes_unit_abbreviated_label$</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>% of Raw $bytes_unit_label$ Reduced</title>
        <search base="redux_io_summary_base_search">
          <query>
| eval raw_bytes_reduced_pct = ((raw_length_orig - raw_length_post) / raw_length_orig) * 100
| table raw_bytes_reduced_pct</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xd41f1f","0x118832"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Total Event $bytes_unit_label$ Reduced</title>
        <search base="redux_io_summary_base_search">
          <query>
| eval e_bytes_reduced = e_length_orig - e_length_post
| table e_bytes_reduced</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">$bytes_precision_single$</option>
        <option name="rangeColors">["0xd41f1f","0x118832"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">$bytes_unit_abbreviated_label$</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>% of Event $bytes_unit_label$ Reduced</title>
        <search base="redux_io_summary_base_search">
          <query>
| eval e_bytes_reduced_pct = ((e_length_orig - e_length_post) / e_length_orig) * 100
| table e_bytes_reduced_pct</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xd41f1f","0x118832"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Total Events Reduced</title>
        <search base="redux_io_summary_base_search">
          <query>
| eval events_reduced = count_orig - count_post
| table events_reduced</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0xd41f1f","0x118832"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>% of Events Reduced</title>
        <search base="redux_io_summary_base_search">
          <query>
| eval events_reduced_pct = ((count_orig - count_post) / count_orig) * 100
| table events_reduced_pct</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xd41f1f","0x118832"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row depends="$show_internal$">
    <panel depends="$show_internal_byte_io$">
      <chart>
        <title>$bytes_unit_label$ I/O Over Time</title>
        <search base="annotation_search" type="annotation"></search>
        <search base="internal_io_time_summary_base_search">
          <query>
| table _time $bytes_unit_label$*</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">$bytes_unit_label$ I/O</option>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"$bytes_unit_label$ In":"0xB88073","$bytes_unit_label$ Out":"0xE38E6F"}</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Events I/O Over Time</title>
        <search base="annotation_search" type="annotation"></search>
        <search base="internal_io_time_summary_base_search">
          <query>
| table _time Events*</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Events I/O</option>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"Events In":"0x2A6293","Events Out":"0x78A1C1"}</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>
  </row>
  <row depends="$show_redux$">
    <panel>
      <chart>
        <title>Raw $bytes_unit_label$ I/O Over Time</title>
        <search base="annotation_search" type="annotation"></search>
        <search base="redux_io_time_summary_base_search">
          <query>
| table _time "Raw $bytes_unit_label$*"</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">$bytes_unit_label$ I/O</option>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"Raw $bytes_unit_label$ In":"0xB88073","Raw $bytes_unit_label$ Out":"0xE38E6F"}</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Raw Event $bytes_unit_label$ I/O Over Time</title>
        <search base="annotation_search" type="annotation"></search>
        <search base="redux_io_time_summary_base_search">
          <query>
| table _time "Event $bytes_unit_label$*"</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">$bytes_unit_label$ I/O</option>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"Event $bytes_unit_label$ In":"0xB88073","Event $bytes_unit_label$ Out":"0xE38E6F"}</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Events I/O Over Time</title>
        <search base="annotation_search" type="annotation"></search>
        <search base="redux_io_time_summary_base_search">
          <query>| table _time "Events In" "Events Out"</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Events I/O</option>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.fieldColors">{"Events In":"0x2A6293","Events Out":"0x78A1C1"}</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row depends="$show_internal$,$show_internal_byte_io$">
    <panel>
      <table>
        <title>Breakdown of $bytes_unit_label$ I/O by $selected_label$</title>
        <search base="internal_io_breakdown_base_search">
          <query>
| eval bytes_reduced = in_bytes - out_bytes, bytes_reduced_pct = (bytes_reduced / in_bytes) * 100
| table $metric_group_by$ instance_type worker_group in_bytes out_bytes bytes_reduced bytes_reduced_pct
| rename name AS Route id AS Pipeline instance_type AS "Instance Type" worker_group AS "Worker Group" in_bytes AS "$bytes_unit_label$ In" out_bytes AS "$bytes_unit_label$ Out" bytes_reduced AS "$bytes_unit_label$ Reduced" bytes_reduced_pct AS "$bytes_unit_label$ Reduced %"
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">true</option>
        <format type="number" field="$bytes_unit_label$ In">
          <option name="precision">$bytes_precision_table$</option>
          <option name="unit">$bytes_unit_abbreviated_label$</option>
        </format>
        <format type="number" field="$bytes_unit_label$ Out">
          <option name="precision">$bytes_precision_table$</option>
          <option name="unit">$bytes_unit_abbreviated_label$</option>
        </format>
        <format type="number" field="$bytes_unit_label$ Reduced">
          <option name="precision">$bytes_precision_table$</option>
          <option name="unit">$bytes_unit_abbreviated_label$</option>
        </format>
        <format type="number" field="$bytes_unit_label$ Reduced %">
          <option name="unit">%</option>
        </format>
        <format type="color" field="$bytes_unit_label$ In">
          <colorPalette type="expression">"#B88073"</colorPalette>
        </format>
        <format type="color" field="$bytes_unit_label$ Out">
          <colorPalette type="expression">"#E38E6F"</colorPalette>
        </format>
        <format type="color" field="$bytes_unit_label$ Reduced">
          <colorPalette type="expression">if(value &lt;= 0, "#D41F1F", "#118832")</colorPalette>
        </format>
        <format type="color" field="$bytes_unit_label$ Reduced %">
          <colorPalette type="expression">if(value &lt;= 0, "#D41F1F", "#118832")</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row depends="$show_redux$">
    <panel>
      <table>
        <title>Breakdown of Raw $bytes_unit_label$ I/O by $selected_label$</title>
        <search base="redux_io_breakdown_base_search">
          <query>| eval raw_bytes_reduced = raw_length_orig - raw_length_post, raw_bytes_reduced_pct = (raw_bytes_reduced / raw_length_orig) * 100
| table $metric_group_by$ instance_type worker_group raw_length_orig raw_length_post raw_bytes_reduced raw_bytes_reduced_pct
| rename name AS Route id AS Pipeline cribl_pipe AS Pipeline instance_type AS "Instance Type" worker_group AS "Worker Group" raw_length_orig AS "Raw $bytes_unit_label$ In" raw_length_post AS "Raw $bytes_unit_label$ Out" raw_bytes_reduced AS "Raw $bytes_unit_label$ Reduced" raw_bytes_reduced_pct AS "Raw $bytes_unit_label$ Reduced %"</query>
        </search>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">true</option>
        <format type="number" field="Raw $bytes_unit_label$ In">
          <option name="precision">$bytes_precision_table$</option>
          <option name="unit">$bytes_unit_abbreviated_label$</option>
        </format>
        <format type="number" field="Raw $bytes_unit_label$ Out">
          <option name="precision">$bytes_precision_table$</option>
          <option name="unit">$bytes_unit_abbreviated_label$</option>
        </format>
        <format type="number" field="Raw $bytes_unit_label$ Reduced">
          <option name="precision">$bytes_precision_table$</option>
          <option name="unit">$bytes_unit_abbreviated_label$</option>
        </format>
        <format type="number" field="Raw $bytes_unit_label$ Reduced %">
          <option name="unit">%</option>
        </format>
        <format type="color" field="Raw $bytes_unit_label$ In">
          <colorPalette type="expression">"#B88073"</colorPalette>
        </format>
        <format type="color" field="Raw $bytes_unit_label$ Out">
          <colorPalette type="expression">"#E38E6F"</colorPalette>
        </format>
        <format type="color" field="Raw $bytes_unit_label$ Reduced">
          <colorPalette type="expression">if(value &lt;= 0, "#D41F1F", "#118832")</colorPalette>
        </format>
        <format type="color" field="Raw $bytes_unit_label$ Reduced %">
          <colorPalette type="expression">if(value &lt;= 0, "#D41F1F", "#118832")</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row depends="$show_redux$">
    <panel>
      <table>
        <title>Breakdown of Event $bytes_unit_label$ I/O by $selected_label$</title>
        <search base="redux_io_breakdown_base_search">
          <query>
| eval e_bytes_reduced = e_length_orig - e_length_post, e_bytes_reduced_pct = (e_bytes_reduced / e_length_orig) * 100
| table $metric_group_by$ instance_type worker_group e_length_orig e_length_post e_bytes_reduced e_bytes_reduced_pct
| rename name AS Route id AS Pipeline cribl_pipe AS Pipeline instance_type AS "Instance Type" worker_group AS "Worker Group" e_length_orig AS "Event $bytes_unit_label$ In" e_length_post AS "Event $bytes_unit_label$ Out" e_bytes_reduced AS "Event $bytes_unit_label$ Reduced" e_bytes_reduced_pct AS "Event $bytes_unit_label$ Reduced %"
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">true</option>
        <format type="number" field="Event $bytes_unit_label$ In">
          <option name="precision">$bytes_precision_table$</option>
          <option name="unit">$bytes_unit_abbreviated_label$</option>
        </format>
        <format type="number" field="Event $bytes_unit_label$ Out">
          <option name="precision">$bytes_precision_table$</option>
          <option name="unit">$bytes_unit_abbreviated_label$</option>
        </format>
        <format type="number" field="Event $bytes_unit_label$ Reduced">
          <option name="precision">$bytes_precision_table$</option>
          <option name="unit">$bytes_unit_abbreviated_label$</option>
        </format>
        <format type="number" field="Event $bytes_unit_label$ Reduced %">
          <option name="unit">%</option>
        </format>
        <format type="color" field="Event $bytes_unit_label$ In">
          <colorPalette type="expression">"#B88073"</colorPalette>
        </format>
        <format type="color" field="Event $bytes_unit_label$ Out">
          <colorPalette type="expression">"#E38E6F"</colorPalette>
        </format>
        <format type="color" field="Event $bytes_unit_label$ Reduced">
          <colorPalette type="expression">if(value &lt;= 0, "#D41F1F", "#118832")</colorPalette>
        </format>
        <format type="color" field="Event $bytes_unit_label$ Reduced %">
          <colorPalette type="expression">if(value &lt;= 0, "#D41F1F", "#118832")</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row depends="$show_internal$">
    <panel>
      <table>
        <title>Breakdown of Event I/O by $selected_label$</title>
        <search base="internal_io_breakdown_base_search">
          <query>
| eval events_reduced = in_events - out_events, events_reduced_pct = (events_reduced / in_events) * 100
| table $metric_group_by$ instance_type worker_group in_events out_events events_reduced events_reduced_pct
| rename name AS Route id AS Pipeline instance_type AS "Instance Type" worker_group AS "Worker Group" in_events AS "Events In" out_events AS "Events Out" events_reduced AS "Events Reduced" events_reduced_pct AS "Events Reduced %"
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">true</option>
        <format type="number" field="Events In">
          <option name="precision">0</option>
        </format>
        <format type="number" field="Events Out">
          <option name="precision">0</option>
        </format>
        <format type="number" field="Events Reduced">
          <option name="precision">0</option>
        </format>
        <format type="number" field="Events Reduced %">
          <option name="unit">%</option>
        </format>
        <format type="color" field="Events In">
          <colorPalette type="expression">"#2A6293"</colorPalette>
        </format>
        <format type="color" field="Events Out">
          <colorPalette type="expression">"#78A1C1"</colorPalette>
        </format>
        <format type="color" field="Events Reduced">
          <colorPalette type="expression">if(value &lt;= 0, "#D41F1F", "#118832")</colorPalette>
        </format>
        <format type="color" field="Events Reduced %">
          <colorPalette type="expression">if(value &lt;= 0, "#D41F1F", "#118832")</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row depends="$show_redux$">
    <panel>
      <table>
        <title>Breakdown of Event I/O by $selected_label$</title>
        <search base="redux_io_breakdown_base_search">
          <query>
| eval events_reduced = count_orig - count_post, events_reduced_pct = (events_reduced / count_orig) * 100
| table $metric_group_by$ instance_type worker_group count_orig count_post events_reduced events_reduced_pct
| rename name AS Route id AS Pipeline cribl_pipe AS Pipeline instance_type AS "Instance Type" worker_group AS "Worker Group" count_orig AS "Events In" count_post AS "Events Out" events_reduced AS "Events Reduced" events_reduced_pct AS "Events Reduced %"
          </query>
        </search>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">true</option>
        <format type="number" field="Events In">
          <option name="precision">0</option>
        </format>
        <format type="number" field="Events Out">
          <option name="precision">0</option>
        </format>
        <format type="number" field="Events Reduced">
          <option name="precision">0</option>
        </format>
        <format type="number" field="Events Reduced %">
          <option name="unit">%</option>
        </format>
        <format type="color" field="Events In">
          <colorPalette type="expression">"#2A6293"</colorPalette>
        </format>
        <format type="color" field="Events Out">
          <colorPalette type="expression">"#78A1C1"</colorPalette>
        </format>
        <format type="color" field="Events Reduced">
          <colorPalette type="expression">if(value &lt;= 0, "#D41F1F", "#118832")</colorPalette>
        </format>
        <format type="color" field="Events Reduced %">
          <colorPalette type="expression">if(value &lt;= 0, "#D41F1F", "#118832")</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row depends="$show_redux$">
    <panel>
      <input type="multiselect" token="time_taken_aggregations" searchWhenChanged="true">
        <label>Time Taken Aggregations</label>
        <choice value="min(time_taken_min) AS time_taken_min">Min</choice>
        <choice value="avg(time_taken_min) AS time_taken_avg">Avg</choice>
        <choice value="max(time_taken_max) AS time_taken_max">Max</choice>
        <choice value="max(time_taken_p90) AS time_taken_p90">P90</choice>
        <choice value="max(time_taken_sd) AS time_taken_sd">Std Dev</choice>
        <default>min(time_taken_min) AS time_taken_min,avg(time_taken_min) AS time_taken_avg,max(time_taken_max) AS time_taken_max</default>
        <initialValue>min(time_taken_min) AS time_taken_min,avg(time_taken_min) AS time_taken_avg,max(time_taken_max) AS time_taken_max</initialValue>
        <delimiter> </delimiter>
      </input>
      <chart>
        <title>Pipeline Processing TImes (ms) Over Time</title>
        <search depends="$show_redux$">
          <query>| mstats $time_taken_aggregations$ WHERE `set_cribl_metrics_index` $environment_filter$ $host_filter$ $metric_group_by$=$selected$ BY host cribl_pipe span=auto fillnull_value=`set_unknown_worker_group_value`
| lookup cribl_stream_assets host OUTPUTNEW instance_type worker_group
| search cribl_pipe !="cribl_reduction_metrics" $worker_group_event_filter$
| stats max(*) AS * BY _time
| fields - cribl_pipe host instance_type worker_group
| rename time_taken_min AS Min time_taken_avg AS Avg time_taken_max AS Max time_taken_p90 AS Perc90 time_taken_sd AS "Std Dev"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Milliseconds</option>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row depends="$show_redux$">
    <panel>
      <table>
        <title>Breakdown of Pipeline Processing Times (ms)</title>
        <search depends="$show_redux$">
          <query>| mstats min(time_taken_min) AS time_taken_min avg(time_taken_avg) AS time_taken_avg max(time_taken_max) AS time_taken_max max(time_taken_sd) AS time_taken_sd max(time_taken_p90) AS time_taken_p90 WHERE `set_cribl_metrics_index` $environment_filter$ $metric$=$selected$ BY host $metric_group_by$ fillnull_value=`set_unknown_worker_group_value`
| lookup cribl_stream_assets host OUTPUTNEW instance_type worker_group
| search $metric_group_by$ != "cribl_reduction_metrics" instance_type IN (worker, single)
| stats max(*) AS * BY $metric_group_by$ instance_type worker_group
| table $metric_group_by$ instance_type worker_group time_taken_min time_taken_avg time_taken_max time_taken_p90 time_taken_sd
| rename cribl_pipe AS Pipeline instance_type AS "Instance Type" worker_group AS "Worker Group" time_taken_min AS Minimum time_taken_avg AS Average time_taken_max AS Maximum time_taken_p90 AS "90th Percentile" time_taken_sd AS "Standard Deviation"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
        <format type="number" field="Minimum">
          <option name="unit">ms</option>
        </format>
        <format type="number" field="Average">
          <option name="unit">ms</option>
        </format>
        <format type="number" field="Maximum">
          <option name="unit">ms</option>
        </format>
        <format type="number" field="90th Percentile">
          <option name="unit">ms</option>
        </format>
        <format type="number" field="Standard Deviation">
          <option name="unit">ms</option>
        </format>
      </table>
    </panel>
  </row>
</form>